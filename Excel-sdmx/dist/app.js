!function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=331)}({331:function(e,t,n){"use strict";function r(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function r(a,i){try{var s=t[a](i),o=s.value}catch(e){return void n(e)}if(!s.done)return Promise.resolve(o).then(function(e){r("next",e)},function(e){r("throw",e)});e(o)}("next")})}}$(document).ready(function(){$(".add-to-db").click(function(){$.ajax({type:"GET",url:$(".providers-list").val()+"/dataflow"}).done(function(e){$(e).find("str\\:Dataflow").each(function(){$.ajax({type:"POST",url:"datasets",data:{datasetId:$(this).attr("id"),title:$(this).find("[xml\\:lang='en']").text(),agencyId:$(this).attr("agencyID"),provider:$(".providers-list option:selected").text(),dsdId:$(this).find("str\\:Structure").find("Ref").attr("id")}}).done(function(e){console.log(e)})})})})}),function(){var e=this;Office.initialize=function(e){$(document).ready(r(regeneratorRuntime.mark(function e(){var t,o,c,d,u,l,f,p,v;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t="",o="",c=[],d="",u="",l="",f="",p="",Office.context.requirements.isSetSupported("ExcelApi",1.1)||($(".warning").removeClass("do-not-display"),$(".main-inputs").css("display","none")),$(document).on("change","#providers",function(){t=$(".providers-list").val(),$(".search-datasets-row").removeClass("d-none"),$(".choose-dataset-row").addClass("d-none"),$(".dataset-query").val("")}),$(".get-datasets").click(r(regeneratorRuntime.mark(function e(){var r,a,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=$(".dataset-query").val(),o=$(".providers-list option:selected").text(),$(".choose-dataset-row").removeClass("d-none"),a="",a="DBnomics"===o?t+"/search?q="+r+"&limit: 30":"datasets?queryString="+r+"&provider="+o,e.next=7,n(a);case 7:i=e.sent,"DBnomics"===o?i.results.docs.forEach(function(e){var t=new Option(e.name,e.code);t.setAttribute("data-agency-id",e.provider_code),$(".datasets-list").append(t)}):i.forEach(function(e){var t=new Option(e.title,e.datasetId);t.setAttribute("data-agency-id",e.agencyId),t.setAttribute("data-dsd-id",e.dsdId),$(".datasets-list").append(t)});case 9:case"end":return e.stop()}},e,this)}))),$(".datasets-list").change(r(regeneratorRuntime.mark(function e(){var a,i;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(d=$(this).children("option:selected").val(),u=$(this).children("option:selected").data("agency-id"),"DBnomics"!==o){e.next=7;break}return $(".main").append('<div class="ms-Grid-row"><div class="ms-Grid-col ms-sm12"><button class="ms-Button get-data"><span class="ms-Button-label">Get data</span></button></div></div>'),e.abrupt("return");case 7:l=$(this).children("option:selected").data("dsd-id"),f=t+"/datastructure/"+u+"/"+l;case 9:return a="",e.prev=10,e.next=13,n(f);case 13:a=e.sent,e.next=20;break;case 16:return e.prev=16,e.t0=e.catch(10),$(".main").append('<div class="row"><div class="col-12"><button class="btn btn-secondary btn-sm btn-block get-data">Get data</button></div></div>'),e.abrupt("return");case 20:"DBnomics"===o?console.log(a.series.docs.length):((i=$(a)).find("str\\:DimensionList").find("str\\:Dimension").each(r(regeneratorRuntime.mark(function e(){var r,a,s,d,l;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=$(this).find("str\\:LocalRepresentation").find("str\\:Enumeration").find("Ref").attr("id"),a="","Eurostat"!==o){e.next=6;break}a=i.find('str\\:Codelist[id="'+r+'"]'),e.next=12;break;case 6:return s=t+"/codelist/"+u+"/"+r,e.t0=$,e.next=10,n(s);case 10:e.t1=e.sent,a=(0,e.t0)(e.t1);case 12:d=a.children("com\\:Name").text(),l=[],$(".main").append('<label for="'+r+'">'+d+'</label><select class="custom-select custom-select-sm rounded-0" id="'+r+'"><option value="">All</option></select>'),a.find("str\\:Code").each(function(){var e=$(this).children("com\\:Name").text(),t=$(this).attr("id");l.push({id:t,text:e});var n=new Option(e,t);$("#"+r).append(n)}),c.push({id:r,title:d,options:l});case 17:case"end":return e.stop()}},e,this)}))),$(".main").append('<div class="row"><div class="col-12"><button class="btn btn-secondary btn-sm btn-block get-data">Get data</button></div></div>'));case 21:case"end":return e.stop()}},e,this,[[10,16]])}))),$(document).on("click",".get-data",r(regeneratorRuntime.mark(function e(){var r,l,f,v,h;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r="",c.forEach(function(e){r+=$("#"+e.id).val()+"."}),r=(r.match(/\./g)||[]).length===c.length?"all":r.substring(0,r.length-1),p="DBnomics"===o?t+"/series?provider_code="+u+"&dataset_code="+d:"Widukind"===o?t+"/"+u+"/data/"+d+"/"+r:t+"/data/"+d+"/"+r,e.next=6,n(p);case 6:l=e.sent,f=a(l,o,c),v=f.length,m=v,g=void 0,b=void 0,y=void 0,g=Math.floor((m-1-26)/676)-1,b=Math.floor((m-1-26)%676/26),y=Math.floor((m-1)%26),h=(g<0?"":String.fromCharCode(97+g))+(b<0?"":String.fromCharCode(97+b))+(y<0?"":String.fromCharCode(97+y)),Excel.run(function(e){var t=e.workbook.worksheets.getActiveWorksheet().tables.add("A1:"+h+"1",!0);return t.getHeaderRowRange().values=[f],"DBnomics"===o?i(l,t,f):s(l,t,c),e.sync()});case 11:case"end":return e.stop()}var m,g,b,y},e,this)}))),$(".explore-dbnomics-spinner").removeClass("do-not-display"),v={providers:{docs:[]}},e.prev=15,e.next=18,n("https://api.db.nomics.world/providers");case 18:v=e.sent,e.next=24;break;case 21:e.prev=21,e.t0=e.catch(15),$('.ms-Pivot-content[data-content="shared"]').append("<span>Error while retrieving BGnomics data!</span>");case 24:$(".explore-dbnomics-spinner").addClass("do-not-display"),v.providers.docs.forEach(function(e){$(".dbnomics-providers-list").append('<li class="list-group-item"><div class="d-flex w-100 justify-content-between"><h6 class="mb-1 text-secondary" data-code="'+e.code+'">'+e.name+'</h6><i class="fas fa-bars"></i></div><p class="mb-1">'+e.website+" ("+e.region+")</p>"+(e.terms_of_use?'<small class="text-muted"><a href="'+e.terms_of_use+'">Terms</a></small>':"")+"</li>")}),$(document).on("click",".fa-bars",r(regeneratorRuntime.mark(function e(){var t,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==(t=$(this).closest("li")).find(".list-group").length){e.next=10;break}return e.next=4,n("https://api.db.nomics.world/v21/providers/"+$(this).prev("h6").data("code"));case 4:r=e.sent,t.append('<ul class="list-group dbnomics-provider-category-list">'),r.category_tree.forEach(function(e){t.append('<li class="list-group-item">'+e.name+"</li>")}),t.append("</ul>"),e.next=12;break;case 10:console.log("Already retrieved"),t.find(".list-group").toggleClass("d-none");case 12:case"end":return e.stop()}},e,this)})));case 27:case"end":return e.stop()}},e,this,[[15,21]])})))};var t,n=(t=r(regeneratorRuntime.mark(function t(n){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,$.ajax({type:"GET",url:n});case 3:return r=e.sent,e.abrupt("return",r);case 7:return e.prev=7,e.t0=e.catch(0),e.abrupt("return",e.t0);case 10:case"end":return e.stop()}},t,e,[[0,7]])})),function(e){return t.apply(this,arguments)}),a=function(e,t,n){var r=new Set;if("DBnomics"===t)e.series.data.forEach(function(e){for(var t in e)e.hasOwnProperty(t)&&!Array.isArray(e[t])&&r.add(t);e.period.forEach(function(e){return r.add(e)})});else{var a=$(e);n.forEach(function(e){r.add(e.title)}),a.find("generic\\:Series").first().find("generic\\:ObsDimension").each(function(){r.add($(this).attr("value"))})}return[].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(r))},i=function(e,t,n){return e.series.data.forEach(function(e){var r=new Array(n.length),a=function(t){e.hasOwnProperty(t)&&!Array.isArray(e[t])&&(r[n.findIndex(function(e){return e===t})]=e[t])};for(var i in e)a(i);e.period.forEach(function(t,a){r[n.findIndex(function(e){return e===t})]=e.value[a]}),t.rows.add(null,[r])}),t},s=function(e,t,n){return $(e).find("generic\\:Series").each(function(){var e=[];$(this).find("generic\\:SeriesKey").find("generic\\:Value").each(function(){var t=this,r=n.filter(function(e){return e.title===$(t).attr("id")});r=r.length>0?r[0].options.filter(function(e){return e.id===$(t).attr("value")})[0].text:$(this).attr("value"),e.push(r)}),$(this).find("generic\\:Obs").each(function(){e.push($(this).find("generic\\:ObsValue").attr("value"))}),t.rows.add(null,[e])}),t}}()}});